import com.cloudbees.hudson.plugins.folder.Folder

def printMyCreds(jenkinsCredentials)
{
  for (c in jenkinsCredentials) {
    if ( c.scope.toString() != "GLOBAL" )
    {
      println( ( "########## Scope: " + c.scope ) )
    }
    if ( c.properties.privateKeySource )
    {
      println( "ID: " + c.id + ", UserName: " + c.username + ", Passphrase: " + c.passphrase + ", Private Key: \n" + c.getPrivateKey() )
    }
    if ( c.properties.secretBytes )
    {
      println( "ID: " + c.id + ", File Name: " + c.fileName + ", Contents: \n" + new String(com.cloudbees.plugins.credentials.SecretBytes.fromString(c.secretBytes.toString()).getPlainData()) )
    }
    if ( c.properties.secret )
    {
      println( "ID: " + c.id + ", Description: " + c.description + ", Secret: " + c.secret )
    }
    if ( c.properties.appID )
    {
      println( "ID: " + c.id + ", appID: " + c.appID + ", API URI: " + c.apiUri + ", Owner: " + c.owner + ", Private Key: \n" + c.privateKey )
    }
    else if ( c.properties.password )
    {
      println( "ID: " + c.id + ", UserName: " + c.username + ", Password: " + c.password + ", Username Secret: " + c.usernameSecret )
    }
  }
}

def allJenkinsItems = Jenkins.getInstance().getItems();
for (currentJenkinsItem in allJenkinsItems)
{
    if(currentJenkinsItem instanceof Folder)
    {
      println( ("###### Diving into Folder: " + currentJenkinsItem.name) )
      jenkinsCredentials = com.cloudbees.plugins.credentials.CredentialsProvider.lookupCredentials(
        com.cloudbees.plugins.credentials.Credentials.class,
        (hudson.model.ItemGroup) currentJenkinsItem
      );
      printMyCreds(jenkinsCredentials)
    }
}

println( ("###### GLOBAL CREDENTIALS: ") )
jenkinsCredentials=com.cloudbees.plugins.credentials.SystemCredentialsProvider.getInstance().getCredentials()
printMyCreds(jenkinsCredentials)
