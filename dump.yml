import jenkins.model.Jenkins
import com.cloudbees.plugins.credentials.*
import com.cloudbees.plugins.credentials.common.*
import com.cloudbees.plugins.credentials.domains.*
import com.cloudbees.hudson.plugins.folder.Folder

// Function to retrieve credentials from a specific folder
def getCredentialsFromFolder(folderPath) {
    def jenkins = Jenkins.instance
    def folder = jenkins

    // Traverse the folder hierarchy
    for (String folderName : folderPath.split("/")) {
        folder = folder.getItem(folderName)
        if (!(folder instanceof Folder)) {
            println("Folder '${folderName}' not found or is not a valid Jenkins folder.")
            return
        }
    }

    // Fetch credentials available in this specific folder
    def credentials = CredentialsProvider.lookupCredentials(
        Credentials.class,
        folder,
        null,
        null
    )

    // Print credentials details
    if (credentials.isEmpty()) {
        println("No credentials found in folder: ${folderPath}")
    } else {
        println("##### Credentials in Folder: ${folderPath} #####")
        credentials.each { cred ->
            if (cred instanceof StandardUsernamePasswordCredentials) {
                println("ID: ${cred.id}, Username: ${cred.username}")
            } else if (cred instanceof StringCredentials) {
                println("ID: ${cred.id}, Secret: ${cred.secret.toString()}")
            } else if (cred instanceof FileCredentials) {
                println("ID: ${cred.id}, File Name: ${cred.fileName}")
            } else if (cred instanceof BasicSSHUserPrivateKey) {
                println("ID: ${cred.id}, Username: ${cred.username}, Private Key: \n${cred.privateKey}")
            }
        }
    }
}

// ðŸ”¹ Change this to your target folder path
def targetFolderPath = "folder1/folder2"

// Fetch credentials from the specified folder
getCredentialsFromFolder(targetFolderPath)
