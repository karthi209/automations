#!/bin/bash

# Output file
OUTPUT_FILE="installed_packages_$(date +%Y%m%d_%H%M%S).txt"
echo "Generating package list..." > "$OUTPUT_FILE"

# Temporary file for unique package storage
TEMP_FILE=$(mktemp)

# Function to collect and append package names uniquely
add_to_list() {
    while read -r pkg; do
        echo "$pkg" >> "$TEMP_FILE"
    done
}

echo -e "\n===== RPM Packages =====" >> "$OUTPUT_FILE"
if command -v rpm &>/dev/null; then
    rpm -qa | sort | add_to_list
else
    echo "RPM not found" >> "$OUTPUT_FILE"
fi

echo -e "\n===== DNF Packages =====" >> "$OUTPUT_FILE"
if command -v dnf &>/dev/null; then
    dnf list installed | awk '{print $1}' | tail -n +2 | sort | add_to_list
else
    echo "DNF not found" >> "$OUTPUT_FILE"
fi

echo -e "\n===== YUM Packages =====" >> "$OUTPUT_FILE"
if command -v yum &>/dev/null; then
    yum list installed | awk '{print $1}' | tail -n +2 | sort | add_to_list
else
    echo "YUM not found" >> "$OUTPUT_FILE"
fi

echo -e "\n===== PIP Packages =====" >> "$OUTPUT_FILE"
if command -v pip &>/dev/null; then
    pip list --format=columns | tail -n +3 | awk '{print $1}' | sort | add_to_list
elif command -v pip3 &>/dev/null; then
    pip3 list --format=columns | tail -n +3 | awk '{print $1}' | sort | add_to_list
else
    echo "PIP not found" >> "$OUTPUT_FILE"
fi

# Remove duplicates and save the final list
sort -u "$TEMP_FILE" >> "$OUTPUT_FILE"
rm -f "$TEMP_FILE"

echo "Package list saved to $OUTPUT_FILE"
