#!/bin/bash

JSON_FILE="/path/to/your.json"  # Update with the actual JSON file path

if [[ ! -f "$JSON_FILE" ]]; then
    echo "Error: JSON file not found at $JSON_FILE"
    exit 1
fi

echo "Executing version checks..."
echo "---------------------------------"

# Process each command in the JSON file
jq -r 'to_entries[] | "\(.key)\n\(.value.command)"' "$JSON_FILE" | while read -r name; do
    read -r cmd

    # Trim spaces (if any)
    name=$(echo "$name" | xargs)
    cmd=$(echo "$cmd" | xargs)

    # Ensure the command is properly quoted
    safe_cmd=$(printf "%q" "$cmd")

    # Debug: Show command before running
    echo "Running check for: $name"
    echo "Executing: $cmd"

    # Run command safely
    result=$(bash -c "$safe_cmd" 2>&1)

    # Handle empty or failed command execution
    if [[ -z "$result" ]]; then
        echo "$name: Command failed or package not found"
    else
        echo "$name: $result"
    fi

    echo "---------------------------------"
done

echo "Done."
